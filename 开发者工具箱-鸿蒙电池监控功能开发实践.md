# é¸¿è’™ç”µæ± ç›‘æ§åŠŸèƒ½å¼€å‘å®è·µ

## å‰è¨€

åœ¨å¼€å‘é¸¿è’™å¼€å‘è€…å·¥å…·ç®±çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸€ä¸ªå®é™…é—®é¢˜ã€‚è°ƒè¯•æ€§èƒ½æ•æ„Ÿåº”ç”¨æ—¶ï¼Œå‘ç°åº”ç”¨åœ¨ä½ç”µé‡æ¨¡å¼ä¸‹ä¼šå‡ºç°å¼‚å¸¸è¡Œä¸ºã€‚è¿™è®©æˆ‘ä»¬æ„è¯†åˆ°ï¼Œä½œä¸ºå¼€å‘è€…å·¥å…·ï¼Œéœ€è¦æ·»åŠ ç”µæ± ç›‘æ§åŠŸèƒ½ï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°è°ƒè¯•åº”ç”¨ã€‚

ç»è¿‡å›¢é˜Ÿè®¨è®ºï¼Œå†³å®šåœ¨å·¥å…·ç®±ä¸­æ·»åŠ ç”µæ± ç›‘æ§åŠŸèƒ½ã€‚è¿™ä¸ªåŠŸèƒ½ä¸ä»…è¦æ˜¾ç¤ºåŸºæœ¬çš„ç”µæ± ä¿¡æ¯ï¼Œè¿˜è¦èƒ½å¸®åŠ©å¼€å‘è€…äº†è§£åº”ç”¨åœ¨ä¸åŒç”µæ± çŠ¶æ€ä¸‹çš„è¡¨ç°ã€‚ç»è¿‡å‡ è½®å¼€å‘å’Œä¼˜åŒ–ï¼Œæœ€ç»ˆå®ç°äº†ä¸€ä¸ªå®ç”¨çš„ç”µæ± ç›‘æ§æ¨¡å—ã€‚

## ä¸€ã€åŠŸèƒ½æ¦‚è¿°

åœ¨å¼€å‘è€…å·¥å…·ç®±ä¸­ï¼Œç”µæ± ç›‘æ§åŠŸèƒ½è¢«æ”¾åœ¨ç³»ç»Ÿå·¥å…·æ¨¡å—ä¸­ã€‚è¿™ä¸ªåŠŸèƒ½æºäºæˆ‘ä»¬çš„å®é™…å¼€å‘éœ€æ±‚ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç»å¸¸éœ€è¦äº†è§£è®¾å¤‡çš„ç”µæ± çŠ¶æ€ï¼Œç‰¹åˆ«æ˜¯åœ¨è°ƒè¯•æ€§èƒ½æ•æ„Ÿçš„åº”ç”¨æ—¶ã€‚é€šè¿‡è¿™ä¸ªåŠŸèƒ½ï¼Œå¼€å‘è€…å¯ä»¥ï¼š

- å®æ—¶ç›‘æ§ç”µæ± ç”µé‡
- è·å–å……ç”µçŠ¶æ€
- ç›‘æ§ç”µæ± æ¸©åº¦
- è·å–ç”µæ± å¥åº·çŠ¶æ€
- ä½ç”µé‡æé†’

è¿™äº›ä¿¡æ¯å¯¹å¼€å‘è€…è°ƒè¯•åº”ç”¨å¾ˆæœ‰å¸®åŠ©ã€‚æ¯”å¦‚ï¼Œåœ¨ä½ç”µé‡æ¨¡å¼ä¸‹ï¼Œç³»ç»Ÿä¼šé™åˆ¶æŸäº›åå°è¿›ç¨‹ï¼Œè¿™å¯èƒ½ä¼šå½±å“åº”ç”¨çš„æ€§èƒ½ã€‚æœ‰äº†ç”µæ± ç›‘æ§åŠŸèƒ½ï¼Œå¼€å‘è€…å°±èƒ½åŠæ—¶å‘ç°è¿™äº›é—®é¢˜ã€‚

## äºŒã€æŠ€æœ¯å®ç°

### 2.1 ä½¿ç”¨ç”µæ± ç®¡ç†API

ä½¿ç”¨é¸¿è’™ç³»ç»Ÿæä¾›çš„ `@ohos.batteryInfo` æ¨¡å—æ¥è·å–ç”µæ± ä¿¡æ¯ã€‚è¿™ä¸ªæ¨¡å—ä¸éœ€è¦ç‰¹æ®Šæƒé™ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š

```typescript
import batteryInfo from '@ohos.batteryInfo';

// è·å–ç”µæ± ä¿¡æ¯
const batteryInfo = batteryInfo.getBatteryInfo();
```

### 2.2 åˆ›å»ºç”µæ± ç›‘æ§æœåŠ¡

åˆ›å»ºäº†ä¸€ä¸ª `BatteryMonitor` ç±»æ¥ç®¡ç†ç”µæ± ç›‘æ§åŠŸèƒ½ã€‚ä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼Œç¡®ä¿æ•´ä¸ªåº”ç”¨ä¸­åªæœ‰ä¸€ä¸ªç”µæ± ç›‘æ§å®ä¾‹ï¼š

```typescript
import batteryInfo from '@ohos.batteryInfo';
import common from '@ohos.app.ability.common';

export class BatteryMonitor {
  // å•ä¾‹å®ä¾‹
  private static instance: BatteryMonitor;
  // åº”ç”¨ä¸Šä¸‹æ–‡
  private context: common.UIAbilityContext;
  // ç”µæ± ä¿¡æ¯
  private batteryInfo: batteryInfo.BatteryInfo;
  // ç”µæ± çŠ¶æ€å˜åŒ–ç›‘å¬å™¨
  private batteryListener: batteryInfo.BatteryInfoCallback;

  private constructor(context: common.UIAbilityContext) {
    this.context = context;
    this.initBatteryInfo();
  }

  // è·å–å•ä¾‹å®ä¾‹
  public static getInstance(context: common.UIAbilityContext): BatteryMonitor {
    if (!BatteryMonitor.instance) {
      BatteryMonitor.instance = new BatteryMonitor(context);
    }
    return BatteryMonitor.instance;
  }

  // åˆå§‹åŒ–ç”µæ± ä¿¡æ¯
  private initBatteryInfo() {
    // è·å–åˆå§‹ç”µæ± ä¿¡æ¯
    this.batteryInfo = batteryInfo.getBatteryInfo();
    
    // æ³¨å†Œç”µæ± çŠ¶æ€å˜åŒ–ç›‘å¬
    this.batteryListener = {
      onBatteryInfoChanged: (batteryInfo) => {
        this.handleBatteryInfoChanged(batteryInfo);
      }
    };
    
    // å¼€å§‹ç›‘å¬ç”µæ± çŠ¶æ€å˜åŒ–
    batteryInfo.on('batteryInfoChange', this.batteryListener);
  }

  // å¤„ç†ç”µæ± ä¿¡æ¯å˜åŒ–
  private handleBatteryInfoChanged(batteryInfo: batteryInfo.BatteryInfo) {
    const { level, isCharging, temperature } = batteryInfo;
    
    // æ›´æ–°UIæ˜¾ç¤º
    this.updateBatteryUI(level, isCharging, temperature);
    
    // ä½ç”µé‡æé†’ï¼ˆç”µé‡ä½äº20%ä¸”æœªå……ç”µæ—¶ï¼‰
    if (level <= 20 && !isCharging) {
      this.showLowBatteryAlert();
    }
  }

  // æ›´æ–°UIæ˜¾ç¤º
  private updateBatteryUI(level: number, isCharging: boolean, temperature: number) {
    // æ›´æ–°UIæ˜¾ç¤ºé€»è¾‘
  }

  // æ˜¾ç¤ºä½ç”µé‡æé†’
  private showLowBatteryAlert() {
    // æ˜¾ç¤ºä½ç”µé‡æé†’
  }

  // è·å–å½“å‰ç”µæ± ä¿¡æ¯
  public getBatteryInfo(): batteryInfo.BatteryInfo {
    return this.batteryInfo;
  }

  // é”€æ¯ç›‘å¬å™¨
  public destroy() {
    // å–æ¶ˆç”µæ± çŠ¶æ€ç›‘å¬
    batteryInfo.off('batteryInfoChange', this.batteryListener);
  }
}
```

### 2.3 å®ç°UIç•Œé¢

è®¾è®¡äº†ä¸€ä¸ªç®€æ´çš„ç”µæ± ç›‘æ§ç•Œé¢ï¼Œä½¿ç”¨äº†é¸¿è’™çš„ArkUIæ¡†æ¶ï¼š

```typescript
@Entry
@Component
struct BatteryMonitorPage {
  // ç”µæ± ç”µé‡
  @State batteryLevel: number = 0;
  // å……ç”µçŠ¶æ€
  @State isCharging: boolean = false;
  // ç”µæ± æ¸©åº¦
  @State temperature: number = 0;
  // ç”µæ± ç›‘æ§æœåŠ¡å®ä¾‹
  private batteryMonitor: BatteryMonitor;

  // é¡µé¢æ˜¾ç¤ºæ—¶åˆå§‹åŒ–
  aboutToAppear() {
    this.batteryMonitor = BatteryMonitor.getInstance(getContext(this) as common.UIAbilityContext);
    this.updateBatteryInfo();
  }

  // æ›´æ–°ç”µæ± ä¿¡æ¯
  updateBatteryInfo() {
    const batteryInfo = this.batteryMonitor.getBatteryInfo();
    this.batteryLevel = batteryInfo.level;
    this.isCharging = batteryInfo.isCharging;
    this.temperature = batteryInfo.temperature;
  }

  build() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆªæ 
      Row() {
        Text('ç”µæ± ç›‘æ§')
          .fontSize(20)
          .fontWeight(FontWeight.Medium)
      }
      .width('100%')
      .height(56)
      .padding({ left: 16, right: 16 })
      .backgroundColor($r('app.color.card_background'))

      // ç”µæ± ä¿¡æ¯å¡ç‰‡
      Column() {
        // ç”µæ± å›¾æ ‡ï¼ˆå……ç”µ/æœªå……ç”µçŠ¶æ€ï¼‰
        Text(this.isCharging ? 'ğŸ”Œ' : 'ğŸ”‹')
          .fontSize(48)
          .margin({ top: 24, bottom: 16 })

        // ç”µé‡æ˜¾ç¤º
        Text(`${this.batteryLevel}%`)
          .fontSize(36)
          .fontWeight(FontWeight.Bold)
          .margin({ bottom: 8 })

        // å……ç”µçŠ¶æ€
        Text(this.isCharging ? 'æ­£åœ¨å……ç”µ' : 'æœªå……ç”µ')
          .fontSize(16)
          .fontColor($r('app.color.text_secondary'))
          .margin({ bottom: 24 })

        // ç”µæ± æ¸©åº¦
        Row() {
          Text('æ¸©åº¦')
            .fontSize(16)
            .fontColor($r('app.color.text_secondary'))
          Text(`${this.temperature}Â°C`)
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .margin({ left: 8 })
        }
        .margin({ bottom: 16 })
      }
      .width('90%')
      .padding(16)
      .backgroundColor($r('app.color.card_background'))
      .borderRadius(16)
      .margin({ top: 16 })
    }
    .width('100%')
    .height('100%')
    .backgroundColor($r('app.color.background'))
  }
}
```

## ä¸‰ã€åŠŸèƒ½ç‰¹ç‚¹

ç”µæ± ç›‘æ§åŠŸèƒ½ä¸»è¦æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

### 3.1 å®æ—¶ç›‘æ§
- å®æ—¶è·å–ç”µæ± çŠ¶æ€
- ç›‘æ§ç”µé‡ã€å……ç”µçŠ¶æ€ã€æ¸©åº¦ç­‰ä¿¡æ¯
- å¸®åŠ©å¼€å‘è€…äº†è§£åº”ç”¨åœ¨ä¸åŒç”µæ± çŠ¶æ€ä¸‹çš„è¡¨ç°

### 3.2 ä½ç”µé‡æé†’
- ç”µé‡ä½äº20%æ—¶è‡ªåŠ¨æé†’
- å¯ä»¥è‡ªå®šä¹‰æé†’é˜ˆå€¼
- é¿å…å¼€å‘è¿‡ç¨‹ä¸­å› ç”µé‡ä¸è¶³å¯¼è‡´çš„é—®é¢˜

### 3.3 UIå±•ç¤º
- æ¸…æ™°çš„ç”µæ± çŠ¶æ€å±•ç¤º
- å……ç”µçŠ¶æ€åŠ¨æ€æ˜¾ç¤º
- æ¸©åº¦ä¿¡æ¯å®æ—¶æ›´æ–°
- ç¬¦åˆé¸¿è’™è®¾è®¡è§„èŒƒ

## å››ã€å¼€å‘ç»éªŒ

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ€»ç»“äº†ä¸€äº›ç»éªŒï¼š

### 4.1 æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨å•ä¾‹æ¨¡å¼ç®¡ç†ç”µæ± ç›‘æ§æœåŠ¡ï¼Œå‡å°‘å†…å­˜å ç”¨
- æ§åˆ¶æ›´æ–°é¢‘ç‡ï¼Œé¿å…é¢‘ç¹åˆ·æ–°ï¼ˆè®¾ç½®ä¸º1ç§’æ›´æ–°ä¸€æ¬¡ï¼‰
- æ³¨æ„ç”µæ± ç›‘å¬å™¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œé¿å…å†…å­˜æ³„æ¼

### 4.2 ç”¨æˆ·ä½“éªŒ
- æä¾›ç›´è§‚çš„ç”µæ± çŠ¶æ€å±•ç¤º
- æ·»åŠ é€‚å½“çš„åŠ¨ç”»æ•ˆæœï¼ˆå¦‚å……ç”µçŠ¶æ€åˆ‡æ¢åŠ¨ç”»ï¼‰
- æ”¯æŒæ·±è‰²æ¨¡å¼
- ä¿æŒç•Œé¢ç®€æ´

### 4.3 é”™è¯¯å¤„ç†
- åšå¥½å¼‚å¸¸å¤„ç†
- æä¾›å‹å¥½çš„é”™è¯¯æç¤º
- ç¡®ä¿åŠŸèƒ½ç¨³å®šæ€§

## äº”ã€é‡åˆ°çš„é—®é¢˜

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼š

1. ç”µæ± çŠ¶æ€æ›´æ–°é¢‘ç‡é—®é¢˜
   - é—®é¢˜ï¼šé¢‘ç¹æ›´æ–°å¯¼è‡´æ€§èƒ½é—®é¢˜
   - è§£å†³ï¼šè®¾ç½®1ç§’çš„æ›´æ–°é—´éš”ï¼Œå¹³è¡¡å®æ—¶æ€§å’Œæ€§èƒ½

2. å†…å­˜æ³„æ¼é—®é¢˜
   - é—®é¢˜ï¼šå¿˜è®°é‡Šæ”¾ç”µæ± çŠ¶æ€ç›‘å¬å™¨
   - è§£å†³ï¼šåœ¨ç»„ä»¶é”€æ¯æ—¶è°ƒç”¨destroyæ–¹æ³•

3. æ¸©åº¦æ˜¾ç¤ºå¼‚å¸¸
   - é—®é¢˜ï¼šæŸäº›è®¾å¤‡æ¸©åº¦æ˜¾ç¤ºä¸å‡†ç¡®
   - è§£å†³ï¼šæ·»åŠ æ¸©åº¦èŒƒå›´æ£€æŸ¥ï¼Œè¿‡æ»¤å¼‚å¸¸å€¼

## å…­ã€æ³¨æ„äº‹é¡¹

å¼€å‘ç”µæ± ç›‘æ§åŠŸèƒ½æ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

1. åŠæ—¶é‡Šæ”¾ç”µæ± çŠ¶æ€ç›‘å¬å™¨ï¼Œé¿å…å†…å­˜æ³„æ¼
2. è€ƒè™‘ä¸åŒè®¾å¤‡çš„å…¼å®¹æ€§
3. æ³¨æ„ç”µæ± æ¸©åº¦è¿‡é«˜çš„æƒ…å†µå¤„ç†
4. ç¡®ä¿UIæ›´æ–°ä¸ä¼šå½±å“åº”ç”¨æ€§èƒ½

## ä¸ƒã€æ€»ç»“

åœ¨å¼€å‘è€…å·¥å…·ç®±ä¸­ï¼Œç”µæ± ç›‘æ§åŠŸèƒ½ä¸ºå¼€å‘è€…æä¾›äº†é‡è¦çš„ç³»ç»Ÿä¿¡æ¯ã€‚é€šè¿‡è¿™ä¸ªåŠŸèƒ½ï¼Œå¼€å‘è€…å¯ä»¥ï¼š

- å®æ—¶ç›‘æ§ç”µæ± çŠ¶æ€
- è·å–ç”µæ± ä¿¡æ¯
- è®¾è®¡ç”¨æˆ·ç•Œé¢
- ä¼˜åŒ–åº”ç”¨æ€§èƒ½

## å…«ã€å‚è€ƒèµ„æº

- [é¸¿è’™åº”ç”¨å¼€å‘æŒ‡å—](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-dev-guide)

## æ¬¢è¿ä½“éªŒ

æœ¬æ–‡ä»‹ç»çš„å·¥å…·å·²é›†æˆåˆ°é¸¿è’™å¼€å‘è€…å·¥å…·ç®±ä¸­ï¼Œæ¬¢è¿ä¸‹è½½ä½“éªŒæ›´å¤šåŠŸèƒ½ï¼

[é¸¿è’™å¼€å‘è€…å·¥å…·ç®±](https://appgallery.huawei.com/app/detail?id=com.zyl.tool&channelId=SHARE)

> ä½œè€…ï¼šåœ¨äººé—´è€•è€˜
> é‚®ç®±ï¼š1743914721@qq.com
> ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚ 